{% extends 'base_layout.html' %}

{% block title %}Netplan{% endblock %}

{% block meta_description %}Examples{% endblock %}

{% block content %}
<div class="p-strip--light is-bordered is-shallow">
  <div class="row">
    <div class="col-12">
      <h1 class="u-no-margin--bottom">Netplan configuration examples</h1>
    </div>
  </div>
</div>
<div class="p-strip">
  <div class="row">
    <div class="col-8 col-medium-4">

    <p>Below are a collection of example netplan configurations for common scenarios. If you see a scenario missing or have one to contribute, please file a bug against this documentation with the example using the links at the bottom of this page. Thank you!</p>
    <h2 id="configuration">Configuration</h2>
    <p>To configure netplan, save configuration files under <code>/etc/netplan/</code> with a <code>.yaml</code> extension (e.g. <code>/etc/netplan/config.yaml</code>), then run <code>sudo netplan apply</code>. This command parses and applies the configuration to the system. Configuration written to disk under <code>/etc/netplan/</code> will persist between reboots.</p>
    <h2 id="using-dhcp-and-static-addressing">Using DHCP and static addressing</h2>
    <p>To let the interface named &#39;enp3s0&#39; get an address via DHCP, create a YAML file with the following:</p>
        

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: true
</pre>

<p>To instead set a static IP address, use the addresses key, which takes a list of (IPv4 or IPv6), addresses along with the subnet prefix length (e.g. /24). DNS information can be provided as well, and the gateway can be defined via a default route:</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      addresses:
        - 10.10.10.2/24
      nameservers:
        search: [mydomain, otherdomain]
        addresses: [10.10.10.1, 1.1.1.1]
      routes:
        - to: default
          via: 10.10.10.1
</pre>

<h2 id="connecting-multiple-interfaces-with-dhcp">Connecting multiple interfaces with DHCP</h2>
<p>Many systems now include more than one network interface. Servers will commonly need to connect to multiple networks, and may require that traffic to the Internet goes through a specific interface despite all of them providing a valid gateway.</p>
<p>One can achieve the exact routing desired over DHCP by specifying a metric for the routes retrieved over DHCP, which will ensure some routes are preferred over others. In this example, &#39;enred&#39; is preferred over &#39;engreen&#39;, as it has a lower route metric:</p>


<pre>network:
  version: 2
  ethernets:
    enred:
      dhcp4: yes
      dhcp4-overrides:
        route-metric: 100
    engreen:
      dhcp4: yes
      dhcp4-overrides:
        route-metric: 200
</pre>

<h2 id="connecting-to-an-open-wireless-network">Connecting to an open wireless network</h2>
<p>Netplan easily supports connecting to an open wireless network (one that is not secured by a password), only requiring that the access point is defined:</p>

<pre>network:
  version: 2
  wifis:
    wl0:
      access-points:
        opennetwork: {}
      dhcp4: yes
</pre>

<h2 id="connecting-to-a-wpa-personal-wireless-network">Connecting to a WPA Personal wireless network</h2>
<p>Wireless devices use the &#39;wifis&#39; key and share the same configuration options with wired ethernet devices. The wireless access point name and password should also be specified:</p>

<pre>network:
  version: 2
  renderer: networkd
  wifis:
    wlp2s0b1:
      dhcp4: no
      dhcp6: no
      addresses: [192.168.0.21/24]
      nameservers:
        addresses: [192.168.0.1, 8.8.8.8]
      access-points:
        "network_ssid_name":
            password: "**********"
      routes:
        - to: default
          via: 192.168.0.1
</pre>

<h2 id="connecting-to-wpa-enterprise-wireless-networks">Connecting to WPA Enterprise wireless networks</h2>
<p>It is also common to find wireless networks secured using WPA or WPA2 Enterprise, which requires additional authentication parameters.</p>
<p>For example, if the network is secured using WPA-EAP and TTLS:</p>

<pre>network:
  version: 2
  wifis:
    wl0:
      access-points:
        workplace:
          auth:
            key-management: eap
            method: ttls
            anonymous-identity: "@internal.example.com"
            identity: "joe@internal.example.com"
            password: "v3ryS3kr1t"
        dhcp4: yes
</pre>

<p>Or, if the network is secured using WPA-EAP and TLS:</p>

<pre>network:
  version: 2
  wifis:
    wl0:
      access-points:
        university:
          auth:
            key-management: eap
            method: tls
            anonymous-identity: "@cust.example.com"
            identity: "cert-joe@cust.example.com"
            ca-certificate: /etc/ssl/cust-cacrt.pem
            client-certificate: /etc/ssl/cust-crt.pem
            client-key: /etc/ssl/cust-key.pem
            client-key-password: "d3cryptPr1v4t3K3y"
      dhcp4: yes
</pre>
<p>Many different modes of encryption are supported. See the <a href="/reference">Netplan reference</a> page.</p>
<h2 id="using-multiple-addresses-on-a-single-interface">Using multiple addresses on a single interface</h2>
<p>The addresses key can take a list of addresses to assign to an interface:</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      addresses:
          - 10.100.1.38/24
          - 10.100.1.39/24
      routes:
          - to: default
            via: 10.100.1.1
</pre>

<p>Interface aliases (e.g. eth0:0) are not supported.</p>
<h2 id="using-multiple-addresses-with-multiple-gateways">Using multiple addresses with multiple gateways</h2>
<p>Similar to the example above, interfaces with multiple addresses can be
configured with multiple gateways.</p>


<pre>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      addresses:
        - 10.0.0.10/24
        - 11.0.0.11/24
        routes:
        - to: default
          via: 10.0.0.1
          metric: 200
        - to: default
          via: 11.0.0.1
          metric: 300
</pre>

<p>We configure individual routes to default (or 0.0.0.0/0) using the address of the gateway for the subnet. The <code>metric</code> value should be adjusted so the routing happens as expected.</p>
<p>DHCP can be used to receive one of the IP addresses for the interface. In this case, the default route for that address will be automatically configured with a <code>metric</code> value of 100.</p>
<h2 id="using-network-manager-as-a-renderer">Using Network Manager as a renderer</h2>
<p>Netplan supports both networkd and Network Manager as backends.    You can specify which network backend should be used to configure particular devices by using the <code>renderer</code> key. You can also delegate all configuration of the network to Network Manager itself by specifying only the <code>renderer</code> key:</p>

<pre>network:
  version: 2
  renderer: NetworkManager
</pre>

<h2 id="configuring-interface-bonding">Configuring interface bonding</h2>
<p>Bonding is configured by declaring a bond interface with a list of physical interfaces and a bonding mode. Below is an example of an active-backup bond that uses DHCP to obtain an address:</p>

<pre>network:
  version: 2
  renderer: networkd
  bonds:
      bond0:
          dhcp4: yes
          interfaces:
              - enp3s0
              - enp4s0
          parameters:
              mode: active-backup
              primary: enp3s0
</pre>

<p>Below is an example of a system acting as a router with various bonded interfaces and different types. Note the 'optional: true' key declarations that allow booting to occur without waiting for those interfaces to activate fully.</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      enp1s0:
          dhcp4: no
      enp2s0:
          dhcp4: no
      enp3s0:
          dhcp4: no
          optional: true
      enp4s0:
          dhcp4: no
          optional: true
      enp5s0:
          dhcp4: no
          optional: true
      enp6s0:
          dhcp4: no
          optional: true
  bonds:
      bond-lan:
          interfaces: [enp2s0, enp3s0]
          addresses: [192.168.93.2/24]
          parameters:
              mode: 802.3ad
              mii-monitor-interval: 1
      bond-wan:
          interfaces: [enp1s0, enp4s0]
          addresses: [192.168.1.252/24]
          nameservers:
              search: [local]
              addresses: [8.8.8.8, 8.8.4.4]
          parameters:
              mode: active-backup
              mii-monitor-interval: 1
              gratuitious-arp: 5
          routes:
              - to: default
                via: 192.168.1.1
      bond-conntrack:
          interfaces: [enp5s0, enp6s0]
          addresses: [192.168.254.2/24]
          parameters:
              mode: balance-rr
              mii-monitor-interval: 1
</pre>

<h2 id="configuring-network-bridges">Configuring network bridges</h2>
<p>To create a very simple bridge consisting of a single device that uses DHCP, write:</p>


<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      enp3s0:
          dhcp4: no
  bridges:
      br0:
          dhcp4: yes
          interfaces:
              - enp3s0
</pre>

<p>A more complex example, to get libvirtd to use a specific bridge with a tagged vlan, while continuing to provide an untagged interface as well would involve:</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      enp0s25:
          dhcp4: true
  bridges:
      br0:
          addresses: [ 10.3.99.25/24 ]
          interfaces: [ vlan15 ]
  vlans:
      vlan15:
          accept-ra: no
          id: 15
          link: enp0s25
</pre>

<p>Then libvirtd would be configured to use this bridge by adding the following content to a new XML file under <code>/etc/libvirtd/qemu/networks/</code>. The name of the bridge in the &lt;bridge&gt; tag as well as in &lt;name&gt; need to match the name of the bridge device configured using netplan:</p>

</pre>xml
<network>
    <name>br0</name>
    <bridge name='br0'/>
    <forward mode="bridge"/>
</network>
</pre>

<h2 id="attaching-vlans-to-network-interfaces">Attaching VLANs to network interfaces</h2>
<p>To configure multiple VLANs with renamed interfaces:</p>


<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      mainif:
          match:
              macaddress: "de:ad:be:ef:ca:fe"
          set-name: mainif
          addresses: [ "10.3.0.5/23" ]
          nameservers:
              addresses: [ "8.8.8.8", "8.8.4.4" ]
              search: [ example.com ]
          routes:
              - to: default
                via: 10.3.0.1
  vlans:
      vlan15:
          id: 15
          link: mainif
          addresses: [ "10.3.99.5/24" ]
      vlan10:
          id: 10
          link: mainif
          addresses: [ "10.3.98.5/24" ]
          nameservers:
              addresses: [ "127.0.0.1" ]
              search: [ domain1.example.com, domain2.example.com ]
</pre>

<h2 id="reaching-a-directly-connected-gateway">Reaching a directly connected gateway</h2>
<p>This allows setting up a default route, or any route, using the &quot;on-link&quot; keyword where the gateway is an IP address that is directly connected to the network even if the address does not match the subnet configured on the interface.</p>


<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      ens3:
          addresses: [ "10.10.10.1/24" ]
          routes:
            - to: default # or 0.0.0.0/0
              via: 9.9.9.9
              on-link: true
</pre>

<p>For IPv6 the config would be very similar, with the notable difference being an additional scope: link host route to the router&#39;s address required:</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      ens3:
          addresses: [ "2001:cafe:face:beef::dead:dead/64" ]
          routes:
            - to: "2001:cafe:face::1/128"
              scope: link
            - to: default # or "::/0"
              via: "2001:cafe:face::1"
              on-link: true
</pre>

<h2 id="configuring-source-routing">Configuring source routing</h2>
<p>Route tables can be added to particular interfaces to allow routing between two networks:</p>
<p>In the example below, ens3 is on the 192.168.3.0/24 network and ens5 is on the 192.168.5.0/24 network. This enables clients on either network to connect to the other and allow the response to come from the correct interface.</p>
<p>Furthermore, the default route is still assigned to ens5 allowing any other traffic to go through it.</p>

<pre>network:
  version: 2
  renderer: networkd
  ethernets:
      ens3:
          addresses:
            - 192.168.3.30/24
          dhcp4: no
          routes:
            - to: 192.168.3.0/24
              via: 192.168.3.1
              table: 101
          routing-policy:
            - from: 192.168.3.0/24
              table: 101
      ens5:
          addresses:
            - 192.168.5.24/24
          dhcp4: no
          routes:
            - to: default
              via: 192.168.5.1
            - to: 192.168.5.0/24
              via: 192.168.5.1
              table: 102
          routing-policy:
            - from: 192.168.5.0/24
              table: 102
</pre>

<h2 id="configuring-a-loopback-interface">Configuring a loopback interface</h2>
<p>Networkd does not allow creating new loopback devices, but a user can add new addresses to the standard loopback interface, lo, in order to have it considered a valid address on the machine as well as for custom routing:</p>

<pre>network:
    version: 2
    renderer: networkd
    ethernets:
        lo:
            addresses: [ "127.0.0.1/8", "::1/128", "7.7.7.7/32" ]
</pre>

<h2 id="integration-with-a-windows-dhcp-server">Integration with a Windows DHCP Server</h2>
<p>For networks where DHCP is provided by a Windows Server using the dhcp-identifier key allows for interoperability:</p>

<pre>network:
  version: 2
  ethernets:
      enp3s0:
          dhcp4: yes
          dhcp-identifier: mac
</pre>

<h2 id="connecting-an-ip-tunnel">Connecting an IP tunnel</h2>
<p>Tunnels allow an administrator to extend networks across the Internet by configuring two endpoints that will connect a special tunnel interface and do the routing required. Netplan supports SIT, GRE, IP-in-IP (ipip, ipip6, ip6ip6), IP6GRE, VTI and VTI6 tunnels.</p>
<p>A common use of tunnels is to enable IPv6 connectivity on networks that only support IPv4. The example below show how such a tunnel might be configured.</p>
<p>Here, 1.1.1.1 is the client&#39;s own IP address; 2.2.2.2 is the remote server&#39;s IPv4 address, &quot;2001:dead:beef::2/64&quot; is the client&#39;s IPv6 address as defined by the tunnel, and &quot;2001:dead:beef::1&quot; is the remote server&#39;s IPv6 address.</p>
<p>Finally, &quot;2001:cafe:face::1/64&quot; is an address for the client within the routed IPv6 prefix:</p>


<pre>network:
  version: 2
  ethernets:
      eth0:
          addresses:
              - 1.1.1.1/24
              - "2001:cafe:face::1/64"
          routes:
              - to: default
                via: 1.1.1.254
  tunnels:
      he-ipv6:
          mode: sit
          remote: 2.2.2.2
          local: 1.1.1.1
          addresses:
              - "2001:dead:beef::2/64"
          routes:
              - to: default
                via: "2001:dead:beef::1"
</pre>

<h2 id="configuring-sr-iov-virtual-functions">Configuring SR-IOV Virtual Functions</h2>
<p>For SR-IOV network cards, it is possible to dynamically allocate Virtual Function interfaces for every configured Physical Function. In netplan, a VF is defined by having a link: property pointing to the parent PF.</p>

<pre>network:
  version: 2
  ethernets:
      eno1:
          mtu: 9000
      enp1s16f1:
          link: eno1
          addresses : [ "10.15.98.25/24" ]
      vf1:
          match:
              name: enp1s16f[2-3]
          link: eno1
          addresses : [ "10.15.99.25/24" ]
</pre>


</div>
  <div class="col-4 col-medium-2 u-hide--small">
    <aside class="p-table-of-contents ">
      <div class="p-table-of-contents__section">
      <h4 class="p-table-of-contents__header">Table of contents</h4>
        <nav class="p-table-of-contents__nav" aria-label="Table of contents">
          <ul class="p-list">
              <li><a class="p-table-of-contents__link" href="#configuration">Configuration</a></li>
              <li><a class="p-table-of-contents__link" href="#using-dhcp-and-static-addressing">Using DHCP and static addressing</a></li>
              <li><a class="p-table-of-contents__link" href="#connecting-multiple-interfaces-with-dhcp">Connecting multiple interfaces with DHCP</a></li>
              <li><a class="p-table-of-contents__link" href="#connecting-to-an-open-wireless-network">Connecting to an open wireless network</a></li>
              <li><a class="p-table-of-contents__link" href="#connecting-to-a-wpa-personal-wireless-network">Connecting to a WPA Personal wireless network</a></li>
              <li><a class="p-table-of-contents__link" href="#connecting-to-wpa-enterprise-wireless-networks">Connecting to WPA Enterprise wireless networks</a></li>
              <li><a class="p-table-of-contents__link" href="#using-multiple-addresses-on-a-single-interface">Using multiple addresses on a single interface</a></li>
              <li><a class="p-table-of-contents__link" href="#using-multiple-addresses-with-multiple-gateways">Using multiple addresses with multiple gateways</a></li>
              <li><a class="p-table-of-contents__link" href="#using-network-manager-as-a-renderer">Using Network Manager as a renderer</a></li>
              <li><a class="p-table-of-contents__link" href="#configuring-interface-bonding">Configuring interface bonding</a></li>
              <li><a class="p-table-of-contents__link" href="#configuring-network-bridges">Configuring network bridges</a></li>
              <li><a class="p-table-of-contents__link" href="#attaching-vlans-to-network-interfaces">Attaching VLANs to network interfaces</a></li>
              <li><a class="p-table-of-contents__link" href="#reaching-a-directly-connected-gateway">Reaching a directly connected gateway</a></li>
              <li><a class="p-table-of-contents__link" href="#configuring-source-routing">Configuring source routing</a></li><li><a href="#configuring-a-loopback-interface">Configuring a loopback interface</a></li>
              <li><a class="p-table-of-contents__link" href="#integration-with-a-windows-dhcp-server">Integration with a Windows DHCP Server</a></li>
              <li><a class="p-table-of-contents__link" href="#connecting-an-ip-tunnel">Connecting an IP tunnel</a></li><li><a href="#configuring-sr-iov-virtual-functions">Configuring SR-IOV Virtual Functions</a></li>
          </ul>
        </nav>
      </div>
    </aside>
  </div>
</div>
</div>
{% endblock content %}
